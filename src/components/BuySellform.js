"use client";
import { useEffect, useState } from "react";
import { useRouter, usePathname } from "next/navigation";
import Select from "react-select";
import toast from "react-hot-toast";
import Image from "next/image";

import { useDispatch } from "react-redux";
import { setUser } from "@/app/store/userSlice";

const countryCodes = [
  { value: "+91", label: "ğŸ‡®ğŸ‡³ +91", name: "India" },
  { value: "+93", label: "ğŸ‡¦ğŸ‡« +93", name: "Afghanistan" },
  { value: "+355", label: "ğŸ‡¦ğŸ‡± +355", name: "Albania" },
  { value: "+213", label: "ğŸ‡©ğŸ‡¿ +213", name: "Algeria" },
  { value: "+1684", label: "ğŸ‡¦ğŸ‡¸ +1684", name: "American Samoa" },
  { value: "+376", label: "ğŸ‡¦ğŸ‡© +376", name: "Andorra" },
  { value: "+244", label: "ğŸ‡¦ğŸ‡´ +244", name: "Angola" },
  { value: "+1264", label: "ğŸ‡¬ğŸ‡¸ +1264", name: "Anguilla" },
  { value: "+672", label: "ğŸ‡¦ğŸ‡¶ +672", name: "Antarctica" },
  { value: "+1268", label: "ğŸ‡¦ğŸ‡¬ +1268", name: "Antigua and Barbuda" },
  { value: "+54", label: "ğŸ‡¦ğŸ‡· +54", name: "Argentina" },
  { value: "+374", label: "ğŸ‡¦ğŸ‡² +374", name: "Armenia" },
  { value: "+297", label: "ğŸ‡¦ğŸ‡¼ +297", name: "Aruba" },
  { value: "+61", label: "ğŸ‡¦ğŸ‡º +61", name: "Australia" },
  { value: "+43", label: "ğŸ‡¦ğŸ‡¹ +43", name: "Austria" },
  { value: "+994", label: "ğŸ‡¦ğŸ‡¿ +994", name: "Azerbaijan" },
  { value: "+1242", label: "ğŸ‡§ğŸ‡¸ +1242", name: "Bahamas" },
  { value: "+973", label: "ğŸ‡§ğŸ‡­ +973", name: "Bahrain" },
  { value: "+880", label: "ğŸ‡§ğŸ‡© +880", name: "Bangladesh" },
  { value: "+1246", label: "ğŸ‡§ğŸ‡§ +1246", name: "Barbados" },
  { value: "+375", label: "ğŸ‡§ğŸ‡¾ +375", name: "Belarus" },
  { value: "+32", label: "ğŸ‡§ğŸ‡ª +32", name: "Belgium" },
  { value: "+501", label: "ğŸ‡§ğŸ‡¿ +501", name: "Belize" },
  { value: "+229", label: "ğŸ‡§ğŸ‡¯ +229", name: "Benin" },
  { value: "+1441", label: "ğŸ‡§ğŸ‡² +1441", name: "Bermuda" },
  { value: "+975", label: "ğŸ‡§ğŸ‡¹ +975", name: "Bhutan" },
  { value: "+591", label: "ğŸ‡§ğŸ‡´ +591", name: "Bolivia" },
  { value: "+387", label: "ğŸ‡§ğŸ‡¦ +387", name: "Bosnia and Herzegovina" },
  { value: "+267", label: "ğŸ‡§ğŸ‡¼ +267", name: "Botswana" },
  { value: "+55", label: "ğŸ‡§ğŸ‡· +55", name: "Brazil" },
  { value: "+246", label: "ğŸ‡®ğŸ‡´ +246", name: "British Indian Ocean Territory" },
  { value: "+673", label: "ğŸ‡§ğŸ‡³ +673", name: "Brunei" },
  { value: "+359", label: "ğŸ‡§ğŸ‡¬ +359", name: "Bulgaria" },
  { value: "+226", label: "ğŸ‡§ğŸ‡« +226", name: "Burkina Faso" },
  { value: "+257", label: "ğŸ‡§ğŸ‡® +257", name: "Burundi" },
  { value: "+855", label: "ğŸ‡°ğŸ‡­ +855", name: "Cambodia" },
  { value: "+237", label: "ğŸ‡¨ğŸ‡² +237", name: "Cameroon" },
  { value: "+1", label: "ğŸ‡¨ğŸ‡¦ +1", name: "Canada" },
  { value: "+238", label: "ğŸ‡¨ğŸ‡» +238", name: "Cape Verde" },
  { value: "+1345", label: "ğŸ‡°ğŸ‡¾ +1345", name: "Cayman Islands" },
  { value: "+236", label: "ğŸ‡¨ğŸ‡« +236", name: "Central African Republic" },
  { value: "+56", label: "ğŸ‡¨ğŸ‡± +56", name: "Chile" },
  { value: "+86", label: "ğŸ‡¨ğŸ‡³ +86", name: "China" },
  { value: "+61", label: "ğŸ‡¨ğŸ‡¨ +61", name: "Christmas Island" },
  { value: "+61", label: "ğŸ‡¨ğŸ‡¨ +61", name: "Cocos (Keeling) Islands" },
  { value: "+57", label: "ğŸ‡¨ğŸ‡´ +57", name: "Colombia" },
  { value: "+269", label: "ğŸ‡°ğŸ‡² +269", name: "Comoros" },
  { value: "+242", label: "ğŸ‡¨ğŸ‡¬ +242", name: "Congo" },
  { value: "+243", label: "ğŸ‡¨ğŸ‡© +243", name: "Congo (Democratic Republic)" },
  { value: "+682", label: "ğŸ‡¨ğŸ‡° +682", name: "Cook Islands" },
  { value: "+506", label: "ğŸ‡¨ğŸ‡· +506", name: "Costa Rica" },
  { value: "+225", label: "ğŸ‡¨ğŸ‡® +225", name: "Ivory Coast" },
  { value: "+385", label: "ğŸ‡­ğŸ‡· +385", name: "Croatia" },
  { value: "+53", label: "ğŸ‡¨ğŸ‡º +53", name: "Cuba" },
  { value: "+357", label: "ğŸ‡¨ğŸ‡¾ +357", name: "Cyprus" },
  { value: "+420", label: "ğŸ‡¨ğŸ‡¿ +420", name: "Czech Republic" },
  { value: "+45", label: "ğŸ‡©ğŸ‡° +45", name: "Denmark" },
  { value: "+253", label: "ğŸ‡©ğŸ‡¯ +253", name: "Djibouti" },
  { value: "+1", label: "ğŸ‡²ğŸ‡¾ +1", name: "Dominica" },
  { value: "+1", label: "ğŸ‡©ğŸ‡´ +1", name: "Dominican Republic" },
  { value: "+670", label: "ğŸ‡©ğŸ‡² +670", name: "East Timor" },
  { value: "+593", label: "ğŸ‡ªğŸ‡¨ +593", name: "Ecuador" },
  { value: "+20", label: "ğŸ‡ªğŸ‡¬ +20", name: "Egypt" },
  { value: "+503", label: "ğŸ‡¸ğŸ‡» +503", name: "El Salvador" },
  { value: "+240", label: "ğŸ‡¬ğŸ‡¶ +240", name: "Equatorial Guinea" },
  { value: "+291", label: "ğŸ‡ªğŸ‡· +291", name: "Eritrea" },
  { value: "+372", label: "ğŸ‡ªğŸ‡ª +372", name: "Estonia" },
  { value: "+251", label: "ğŸ‡ªğŸ‡¹ +251", name: "Ethiopia" },
  { value: "+500", label: "ğŸ‡¬ğŸ‡® +500", name: "Falkland Islands" },
  { value: "+298", label: "ğŸ‡©ğŸ‡´ +298", name: "Faroe Islands" },
  { value: "+679", label: "ğŸ‡«ğŸ‡¯ +679", name: "Fiji" },
  { value: "+358", label: "ğŸ‡«ğŸ‡® +358", name: "Finland" },
  { value: "+33", label: "ğŸ‡«ğŸ‡· +33", name: "France" },
  { value: "+594", label: "ğŸ‡¬ğŸ‡³ +594", name: "French Guiana" },
  { value: "+689", label: "ğŸ‡µğŸ‡¬ +689", name: "French Polynesia" },
  { value: "+241", label: "ğŸ‡¶ğŸ‡¸ +241", name: "Gabon" },
  { value: "+220", label: "ğŸ‡¬ğŸ‡­ +220", name: "Gambia" },
  { value: "+995", label: "ğŸ‡¬ğŸ‡ª +995", name: "Georgia" },
  { value: "+49", label: "ğŸ‡©ğŸ‡ª +49", name: "Germany" },
  { value: "+233", label: "ğŸ‡¬ğŸ‡­ +233", name: "Ghana" },
  { value: "+350", label: "ğŸ‡¬ğŸ‡® +350", name: "Gibraltar" },
  { value: "+30", label: "ğŸ‡¬ğŸ‡· +30", name: "Greece" },
  { value: "+299", label: "ğŸ‡¬ğŸ‡¸ +299", name: "Greenland" },
  { value: "+1473", label: "ğŸ‡¬ğŸ‡© +1473", name: "Grenada" },
  { value: "+1", label: "ğŸ‡¬ğŸ‡© +1", name: "Guadeloupe" },
  { value: "+1671", label: "ğŸ‡¬ğŸ‡º +1671", name: "Guam" },
  { value: "+502", label: "ğŸ‡¬ğŸ‡¹ +502", name: "Guatemala" },
  { value: "+224", label: "ğŸ‡¬ğŸ‡³ +224", name: "Guinea" },
  { value: "+245", label: "ğŸ‡¬ğŸ‡¼ +245", name: "Guinea-Bissau" },
  { value: "+592", label: "ğŸ‡¬ğŸ‡¾ +592", name: "Guyana" },
  { value: "+509", label: "ğŸ‡­ğŸ‡¹ +509", name: "Haiti" },
  { value: "+504", label: "ğŸ‡­ğŸ‡³ +504", name: "Honduras" },
  { value: "+852", label: "ğŸ‡­ğŸ‡° +852", name: "Hong Kong" },
  { value: "+36", label: "ğŸ‡­ğŸ‡º +36", name: "Hungary" },
  { value: "+354", label: "ğŸ‡®ğŸ‡¸ +354", name: "Iceland" },
  { value: "+62", label: "ğŸ‡®ğŸ‡© +62", name: "Indonesia" },
  { value: "+98", label: "ğŸ‡®ğŸ‡· +98", name: "Iran" },
  { value: "+964", label: "ğŸ‡®ğŸ‡¶ +964", name: "Iraq" },
  { value: "+353", label: "ğŸ‡®ğŸ‡ª +353", name: "Ireland" },
  { value: "+972", label: "ğŸ‡®ğŸ‡± +972", name: "Israel" },
  { value: "+39", label: "ğŸ‡®ğŸ‡¹ +39", name: "Italy" },
  { value: "+1876", label: "ğŸ‡¯ğŸ‡² +1876", name: "Jamaica" },
  { value: "+81", label: "ğŸ‡¯ğŸ‡µ +81", name: "Japan" },
  { value: "+962", label: "ğŸ‡¯ğŸ‡´ +962", name: "Jordan" },
  { value: "+254", label: "ğŸ‡°ğŸ‡ª +254", name: "Kenya" },
  { value: "+996", label: "ğŸ‡°ğŸ‡¬ +996", name: "Kyrgyzstan" },
  { value: "+856", label: "ğŸ‡±ğŸ‡¸ +856", name: "Laos" },
  { value: "+371", label: "ğŸ‡±ğŸ‡» +371", name: "Latvia" },
  { value: "+961", label: "ğŸ‡±ğŸ‡§ +961", name: "Lebanon" },
  { value: "+266", label: "ğŸ‡±ğŸ‡¸ +266", name: "Lesotho" },
  { value: "+231", label: "ğŸ‡±ğŸ‡· +231", name: "Liberia" },
  { value: "+218", label: "ğŸ‡±ğŸ‡¾ +218", name: "Libya" },
  { value: "+423", label: "ğŸ‡±ğŸ‡® +423", name: "Liechtenstein" },
  { value: "+370", label: "ğŸ‡±ğŸ‡¹ +370", name: "Lithuania" },
  { value: "+352", label: "ğŸ‡±ğŸ‡º +352", name: "Luxembourg" },
  { value: "+853", label: "ğŸ‡²ğŸ‡´ +853", name: "Macau" },
  { value: "+389", label: "ğŸ‡²ğŸ‡° +389", name: "Macedonia" },
  { value: "+261", label: "ğŸ‡²ğŸ‡¬ +261", name: "Madagascar" },
  { value: "+265", label: "ğŸ‡²ğŸ‡¼ +265", name: "Malawi" },
  { value: "+60", label: "ğŸ‡²ğŸ‡¾ +60", name: "Malaysia" },
  { value: "+960", label: "ğŸ‡²ğŸ‡» +960", name: "Maldives" },
  { value: "+223", label: "ğŸ‡²ğŸ‡± +223", name: "Mali" },
  { value: "+356", label: "ğŸ‡²ğŸ‡¹ +356", name: "Malta" },
  { value: "+692", label: "ğŸ‡²ğŸ‡­ +692", name: "Marshall Islands" },
  { value: "+596", label: "ğŸ‡²ğŸ‡¬ +596", name: "Martinique" },
  { value: "+222", label: "ğŸ‡²ğŸ‡· +222", name: "Mauritania" },
  { value: "+230", label: "ğŸ‡²ğŸ‡º +230", name: "Mauritius" },
  { value: "+262", label: "ğŸ‡²ğŸ‡¶ +262", name: "Mayotte" },
  { value: "+52", label: "ğŸ‡²ğŸ‡½ +52", name: "Mexico" },
  { value: "+691", label: "ğŸ‡²ğŸ‡½ +691", name: "Micronesia" },
  { value: "+373", label: "ğŸ‡²ğŸ‡© +373", name: "Moldova" },
  { value: "+377", label: "ğŸ‡²ğŸ‡¨ +377", name: "Monaco" },
  { value: "+976", label: "ğŸ‡²ğŸ‡³ +976", name: "Mongolia" },
  { value: "+382", label: "ğŸ‡²ğŸ‡ª +382", name: "Montenegro" },
  { value: "+1", label: "ğŸ‡²ğŸ‡¸ +1", name: "Montserrat" },
  { value: "+212", label: "ğŸ‡²ğŸ‡¦ +212", name: "Morocco" },
  { value: "+258", label: "ğŸ‡²ğŸ‡¿ +258", name: "Mozambique" },
  { value: "+95", label: "ğŸ‡²ğŸ‡² +95", name: "Myanmar" },
  { value: "+264", label: "ğŸ‡³ğŸ‡¦ +264", name: "Namibia" },
  { value: "+674", label: "ğŸ‡³ğŸ‡· +674", name: "Nauru" },
  { value: "+977", label: "ğŸ‡³ğŸ‡µ +977", name: "Nepal" },
  { value: "+31", label: "ğŸ‡³ğŸ‡± +31", name: "Netherlands" },
  { value: "+64", label: "ğŸ‡³ğŸ‡¿ +64", name: "New Zealand" },
  { value: "+505", label: "ğŸ‡³ğŸ‡® +505", name: "Nicaragua" },
  { value: "+227", label: "ğŸ‡³ğŸ‡ª +227", name: "Niger" },
  { value: "+234", label: "ğŸ‡³ğŸ‡¬ +234", name: "Nigeria" },
  { value: "+683", label: "ğŸ‡³ğŸ‡º +683", name: "Niue" },
  { value: "+672", label: "ğŸ‡³ğŸ‡® +672", name: "Norfolk Island" },
  { value: "+1", label: "ğŸ‡³ğŸ‡· +1", name: "Northern Mariana Islands" },
  { value: "+47", label: "ğŸ‡³ğŸ‡´ +47", name: "Norway" },
  { value: "+968", label: "ğŸ‡´ğŸ‡² +968", name: "Oman" },
  { value: "+92", label: "ğŸ‡µğŸ‡° +92", name: "Pakistan" },
  { value: "+680", label: "ğŸ‡µğŸ‡¼ +680", name: "Palau" },
  { value: "+970", label: "ğŸ‡µğŸ‡¸ +970", name: "Palestine" },
  { value: "+507", label: "ğŸ‡µğŸ‡¦ +507", name: "Panama" },
  { value: "+675", label: "ğŸ‡µğŸ‡¬ +675", name: "Papua New Guinea" },
  { value: "+595", label: "ğŸ‡µğŸ‡¾ +595", name: "Paraguay" },
  { value: "+51", label: "ğŸ‡µğŸ‡ª +51", name: "Peru" },
  { value: "+63", label: "ğŸ‡µğŸ‡­ +63", name: "Philippines" },
  { value: "+48", label: "ğŸ‡µğŸ‡± +48", name: "Poland" },
  { value: "+351", label: "ğŸ‡µğŸ‡¹ +351", name: "Portugal" },
  { value: "+1", label: "ğŸ‡µğŸ‡· +1", name: "Puerto Rico" },
  { value: "+974", label: "ğŸ‡¶ğŸ‡¦ +974", name: "Qatar" },
  { value: "+40", label: "ğŸ‡·ğŸ‡´ +40", name: "Romania" },
  { value: "+7", label: "ğŸ‡·ğŸ‡º +7", name: "Russia" },
  { value: "+250", label: "ğŸ‡·ğŸ‡¼ +250", name: "Rwanda" },
  { value: "+290", label: "ğŸ‡¾ğŸ‡¹ +290", name: "Saint Helena" },
  { value: "+1869", label: "ğŸ‡°ğŸ‡³ +1869", name: "Saint Kitts and Nevis" },
  { value: "+1758", label: "ğŸ‡±ğŸ‡¨ +1758", name: "Saint Lucia" },
  { value: "+1", label: "ğŸ‡±ğŸ‡® +1", name: "Saint Pierre and Miquelon" },
  { value: "+1", label: "ğŸ‡»ğŸ‡¨ +1", name: "Saint Vincent and the Grenadines" },
  { value: "+684", label: "ğŸ‡¼ğŸ‡¸ +684", name: "Samoa" },
  { value: "+378", label: "ğŸ‡¸ğŸ‡² +378", name: "San Marino" },
  { value: "+239", label: "ğŸ‡¸ğŸ‡¹ +239", name: "Sao Tome and Principe" },
  { value: "+966", label: "ğŸ‡¸ğŸ‡¦ +966", name: "Saudi Arabia" },
  { value: "+221", label: "ğŸ‡¸ğŸ‡³ +221", name: "Senegal" },
  { value: "+381", label: "ğŸ‡·ğŸ‡¸ +381", name: "Serbia" },
  { value: "+248", label: "ğŸ‡¸ğŸ‡¨ +248", name: "Seychelles" },
  { value: "+232", label: "ğŸ‡¸ğŸ‡± +232", name: "Sierra Leone" },
  { value: "+65", label: "ğŸ‡¸ğŸ‡¬ +65", name: "Singapore" },
  { value: "+421", label: "ğŸ‡¸ğŸ‡° +421", name: "Slovakia" },
  { value: "+386", label: "ğŸ‡¸ğŸ‡® +386", name: "Slovenia" },
  { value: "+677", label: "ğŸ‡¸ğŸ‡§ +677", name: "Solomon Islands" },
  { value: "+252", label: "ğŸ‡¸ğŸ‡´ +252", name: "Somalia" },
  { value: "+27", label: "ğŸ‡¿ğŸ‡¦ +27", name: "South Africa" },
  { value: "+82", label: "ğŸ‡°ğŸ‡· +82", name: "South Korea" },
  { value: "+34", label: "ğŸ‡ªğŸ‡¸ +34", name: "Spain" },
  { value: "+94", label: "ğŸ‡±ğŸ‡° +94", name: "Sri Lanka" },
  { value: "+249", label: "ğŸ‡¸ğŸ‡© +249", name: "Sudan" },
  { value: "+597", label: "ğŸ‡¸ğŸ‡· +597", name: "Suriname" },
  { value: "+268", label: "ğŸ‡¸ğŸ‡¿ +268", name: "Swaziland" },
  { value: "+46", label: "ğŸ‡¸ğŸ‡ª +46", name: "Sweden" },
  { value: "+41", label: "ğŸ‡¨ğŸ‡­ +41", name: "Switzerland" },
  { value: "+963", label: "ğŸ‡¸ğŸ‡¾ +963", name: "Syria" },
  { value: "+886", label: "ğŸ‡¹ğŸ‡¼ +886", name: "Taiwan" },
  { value: "+992", label: "ğŸ‡¹ğŸ‡¯ +992", name: "Tajikistan" },
  { value: "+255", label: "ğŸ‡¹ğŸ‡¿ +255", name: "Tanzania" },
  { value: "+66", label: "ğŸ‡¹ğŸ‡­ +66", name: "Thailand" },
  { value: "+670", label: "ğŸ‡¹ğŸ‡± +670", name: "Timor-Leste" },
  { value: "+228", label: "ğŸ‡¹ğŸ‡¬ +228", name: "Togo" },
  { value: "+690", label: "ğŸ‡¹ğŸ‡´ +690", name: "Tonga" },
  { value: "+1", label: "ğŸ‡¹ğŸ‡¹ +1", name: "Trinidad and Tobago" },
  { value: "+216", label: "ğŸ‡¹ğŸ‡³ +216", name: "Tunisia" },
  { value: "+90", label: "ğŸ‡¹ğŸ‡· +90", name: "Turkey" },
  { value: "+993", label: "ğŸ‡¹ğŸ‡² +993", name: "Turkmenistan" },
  { value: "+1", label: "ğŸ‡¹ğŸ‡» +1", name: "Tuvalu" },
  { value: "+256", label: "ğŸ‡ºğŸ‡¬ +256", name: "Uganda" },
  { value: "+380", label: "ğŸ‡ºğŸ‡¦ +380", name: "Ukraine" },
  { value: "+971", label: "ğŸ‡¦ğŸ‡ª +971", name: "United Arab Emirates" },
  { value: "+44", label: "ğŸ‡¬ğŸ‡§ +44", name: "United Kingdom" },
  { value: "+1", label: "ğŸ‡ºğŸ‡¸ +1", name: "United States" },
  { value: "+598", label: "ğŸ‡ºğŸ‡¾ +598", name: "Uruguay" },
  { value: "+998", label: "ğŸ‡ºğŸ‡¿ +998", name: "Uzbekistan" },
  { value: "+678", label: "ğŸ‡»ğŸ‡º +678", name: "Vanuatu" },
  { value: "+58", label: "ğŸ‡»ğŸ‡ª +58", name: "Venezuela" },
  { value: "+84", label: "ğŸ‡»ğŸ‡³ +84", name: "Vietnam" },
  { value: "+1", label: "ğŸ‡»ğŸ‡¬ +1", name: "Virgin Islands" },
  { value: "+684", label: "ğŸ‡»ğŸ‡º +684", name: "Wallis and Futuna" },
  { value: "+967", label: "ğŸ‡¾ğŸ‡ª +967", name: "Yemen" },
  { value: "+260", label: "ğŸ‡¿ğŸ‡² +260", name: "Zambia" },
  { value: "+263", label: "ğŸ‡¿ğŸ‡¼ +263", name: "Zimbabwe" }
];


const BuySellForm = ({ productname: initialProductName }) => {
  const [productname, setProductname] = useState(initialProductName || "");
  const [showModal, setShowModal] = useState(false);
  const [buySell, setBuySell] = useState("buy");
  const [fullname, setFullname] = useState("");
  const [countryCode, setCountryCode] = useState(countryCodes[1]);
  const [mobileNumber, setMobileNumber] = useState("");
  const [email, setEmail] = useState("");
  const [pincode, setPincode] = useState("");
  const [companyName, setCompanyName] = useState("");
  const [loading, setLoading] = useState(false);
  const [otpSent, setOtpSent] = useState(false);
  const [otp, setOtp] = useState("");
  const [message, setMessage] = useState("");
  const [error, setError] = useState("");

  const dispatch = useDispatch();
  const router = useRouter();

  useEffect(() => {
    const timer = setTimeout(() => setShowModal(true), 9000);
    return () => clearTimeout(timer);
  }, []);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setMessage("");
    setError("");

    try {
      const fullMobileNumber = `${countryCode.value}${mobileNumber.replace(/\s/g, "")}`;
      const apiUrl = buySell === "buy" ? "/api/auth/sendotpbuyer" : "/api/auth/sendotp";
      const requestBody = {
        fullname,
      email,
      mobileNumber: fullMobileNumber,
      countryCode: countryCode.value,
      productname, // Added product name
      };
      
      if (buySell === "sell") {
        requestBody.companyName = companyName;
        requestBody.pincode = pincode;
        requestBody.productname = productname;
        requestBody.fullname = fullname;
        requestBody.email = email;
        requestBody.mobileNumber = fullMobileNumber;
      }

      const res = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(requestBody),
      });

      const data = await res.json();
      if (res.ok) {
        setMessage(data.message);
        setOtpSent(true);
      } else {
        setError(data.error || "Unexpected error occurred.");
      }
    } catch (err) {
      setError("Something went wrong!");
    } finally {
      setLoading(false);
    }
  };

  const handleOtpVerify = async (e) => {
    e.preventDefault();
    setLoading(true);
    setMessage("");
    setError("");
  
    try {
      const fullMobileNumber = `${countryCode.value}${mobileNumber.replace(/\s/g, "")}`;
      const apiUrl = buySell === "buy" 
        ? "/api/auth/verifyotpbuyer" 
        : `/api/auth/verifyotp`; // Seller API
  
      const res = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobileNumber: fullMobileNumber, otp }),
      });
  
      const data = await res.json();
      if (res.ok) {
        setMessage("OTP verified successfully!");
  
        if (buySell === "sell") {
         // Redux store update karen
         dispatch(setUser({ user: data.user, token: data.token }));
          router.push("/userdashboard");
        } else {
          toast.success("verified")
        }
        setShowModal(false);
      } else {
        setError(data.error || "Invalid OTP. Please try again.");
      }
    } catch (err) {
      setError("Invalid OTP or something went wrong!");
    } finally {
      setLoading(false);
    }
  };
  

  return (

    <>
  
    <div className={`modal fade ${showModal ? "show d-block" : ""}`} style={{ background: "rgba(0, 0, 0, 0.5)" }} >
      <div className="modal-dialog modal-dialog-centered modal-lg">
        <div className="modal-content p-4">
          <div className="modal-header">
            <h5 className="modal-title fw-bold">Tell us what you need</h5>
            <button type="button" className="btn-close" onClick={() => setShowModal(false)}></button>
          </div>

          <div className="row">
          <div className="col-md-6 d-flex align-items-center justify-content-center">
            
          <div className="relative w-full h-[200px] sm:h-[250px] md:h-[300px] mt-3">
  <Image 
    src="/assets/pop1.jpeg" 
    alt="App Store"
    fill
    className="object-contain"
  />
</div>


</div>

    <div className="col-md-6">
    <div className="modal-body">
            {message && <p className="text-success">{message}</p>}
            {error && <p className="text-danger">{error}</p>}

            {otpSent ? (
              <form onSubmit={handleOtpVerify}>
                <div className="mb-3">
                  <input type="text" value={otp} onChange={(e) => setOtp(e.target.value)} required className="form-control" placeholder="Enter OTP" />
                </div>
                <button type="submit" className="btn btn-success w-100" disabled={loading}>{loading ? "Verifying OTP..." : "Verify OTP"}</button>
              </form>
            ) : (
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label className="form-label">I want to:</label>
                  <div>
                    <input type="radio" name="buy_sell" value="buy" className="form-check-input me-2" checked={buySell === "buy"} onChange={() => setBuySell("buy")} /> Buy
                    <input type="radio" name="buy_sell" value="sell" className="form-check-input ms-3 me-2" checked={buySell === "sell"} onChange={() => setBuySell("sell")} /> Sell
                  </div>
                </div>
                <div className="mb-2">
                  <input type="text" value={productname} onChange={(e) => setProductname(e.target.value)} required className="form-control" placeholder="Product Name" />
                </div>
                <div className="mb-2 d-flex">
                  <Select options={countryCodes} value={countryCode} onChange={setCountryCode} className="me-2" />
                  <input type="text" value={mobileNumber} onChange={(e) => setMobileNumber(e.target.value)} required className="form-control" placeholder="Mobile Number" />
                </div>
               
                {buySell === "sell" && (
                  <>
                    <input type="text" value={fullname} onChange={(e) => setFullname(e.target.value)} required className="form-control mb-2" placeholder="Full Name" />
                    <input type="text" value={email} onChange={(e) => setEmail(e.target.value)} required className="form-control mb-2" placeholder="Email" />
                    <input type="text" value={companyName} onChange={(e) => setCompanyName(e.target.value)} required className="form-control mb-2" placeholder="Company Name" />
                    <input type="text" value={pincode} onChange={(e) => setPincode(e.target.value)} required className="form-control mb-2" placeholder="Pincode" />
                  </>
                )}
                <button type="submit" className="btn btn-primary w-100" disabled={loading}>{loading ? "Sending OTP..." : "Send OTP"}</button>
              </form>
            )}
          </div>
    </div>
    </div>

        </div>
      </div>
    </div>
    </>


  );
};

export default BuySellForm;
